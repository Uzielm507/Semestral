<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon Finder - Semestral DS5</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <main class="pokeball-container">

        <header class="main-header">
            <h1 class="app-title">POKÉMON FINDER</h1>
            <nav class="main-nav">
                <button class="nav-btn active" id="btn-nav-buscar"><i class="fa-solid fa-magnifying-glass"></i> BUSCAR</button>
                <button class="nav-btn" id="btn-nav-historico"><i class="fa-solid fa-scroll"></i> HISTÓRICO</button>
                <button class="nav-btn" id="btn-nav-vs"><i class="fa-solid fa-swords"></i> VS</button>
                <button class="nav-btn" id="btn-nav-favoritos"><i class="fa-solid fa-heart"></i> FAVORITOS</button>
            </nav>
        </header>

        <div class="content-display">

            <section id="view-buscar" class="view-section active">
                
                <div class="search-controls">
                    <div class="search-type-toggle">
                        <label>
                            <input type="radio" name="searchType" value="pokemon" checked> 
                            <span><i class="fa-solid fa-paw"></i> POKÉMON</span>
                        </label>
                        <label>
                            <input type="radio" name="searchType" value="ability"> 
                            <span><i class="fa-solid fa-bolt"></i> HABILIDAD</span>
                        </label>
                    </div>
                    <div class="search-bar">
                        <input type="text" id="search-input" placeholder="NOMBRE O ID...">
                        <button id="btn-search-action">BUSCAR</button>
                    </div>
                </div>

                <div id="start-message" class="empty-state">
                    <p>Ingresa un Pokémon para comenzar</p>
                </div>

                <div id="pokemon-card-container" class="pokemon-card hidden">
                    
                    <div class="source-badge" id="data-source-badge"></div>

                    <div class="card-header">
                        <h2 id="poke-name"></h2>
                    </div>

                    <div class="card-visuals">
                        <div class="sprite-container">
                            <img id="poke-sprite" src="" alt="Sprite Pokémon">
                        </div>
                        <div class="types-container" id="poke-types">
                            </div>
                    </div>

                    <div class="abilities-section">
                        <h3>HABILIDADES</h3>
                        <div id="poke-abilities" class="abilities-list">
                            </div>
                    </div>

                    <div class="stats-section" id="poke-stats-container">
                        </div>

                    <div class="favorite-action">
                        <button id="btn-toggle-fav" class="fav-heart-btn">
                            <i class="fa-regular fa-heart"></i>
                        </button>
                    </div>

                    <div class="evolution-section">
                        <h3>CADENA DE EVOLUCIÓN</h3>
                        <div class="evolution-chain" id="evolution-container">
                            </div>
                    </div>
                </div>

                <div id="ability-card-container" class="ability-card hidden">
                    <h2 id="ability-name"></h2>
                    <p id="ability-desc"></p>
                    <h3>POKÉMON CON ESTA HABILIDAD</h3>
                    <div id="ability-pokemon-list" class="grid-list">
                        </div>
                </div>
            </section>

            <section id="view-historico" class="view-section hidden">
                <div class="list-header">
                    <h2>HISTÓRICO</h2>
                </div>
                <div id="history-list" class="pokemon-list-container">
                    <div class="empty-state">
                        <i class="fa-solid fa-box-open"></i>
                        <p>NO HAY POKÉMONES EN EL HISTÓRICO</p>
                    </div>
                </div>
                <button id="btn-clear-history" class="btn-danger">LIMPIAR TODO</button>
            </section>

            <section id="view-favoritos" class="view-section hidden">
                <div class="list-header">
                    <h2>FAVORITOS</h2>
                </div>
                <div id="favorites-list" class="pokemon-list-container">
                    <div class="empty-state">
                        <i class="fa-solid fa-heart-crack"></i>
                        <p>NO TIENES POKÉMONES FAVORITOS</p>
                    </div>
                </div>
                <button id="btn-clear-favorites" class="btn-danger">LIMPIAR TODO</button>
            </section>

            <section id="view-vs" class="view-section hidden">
                <div class="vs-header">
                    <h2>POKÉMON VS</h2>
                </div>

                <div class="vs-inputs">
                    <div class="fighter-input">
                        <input type="text" id="vs-input-1" placeholder="Pokémon 1...">
                    </div>
                    <div class="vs-badge">VS</div>
                    <div class="fighter-input">
                        <input type="text" id="vs-input-2" placeholder="Pokémon 2...">
                    </div>
                </div>

                <button id="btn-start-battle" class="btn-battle">¡BATALLAR!</button>

                <div id="battle-results" class="battle-results hidden">
                    
                    <div class="fighters-display">
                        <div class="fighter-card" id="fighter-1-card">
                            <div class="winner-badge hidden">GANADOR</div>
                            <img src="" alt="Fighter 1" id="f1-img">
                            <h3 id="f1-name">???</h3> <div class="f-types" id="f1-types"></div>
                            <div class="total-points" id="f1-points">0 pts</div>
                        </div>

                        <div class="vs-divider">VS</div>

                        <div class="fighter-card" id="fighter-2-card">
                            <div class="winner-badge hidden">GANADOR</div>
                            <img src="" alt="Fighter 2" id="f2-img">
                            <h3 id="f2-name">???</h3> <div class="f-types" id="f2-types"></div>
                            <div class="total-points" id="f2-points">0 pts</div>
                        </div>
                    </div>

                    <div class="battle-analysis">
                        <h3>ANÁLISIS DE BATALLA</h3>
                        <div id="type-advantages-text" class="analysis-box"></div>
                    </div>

                    <div class="stats-comparison">
                        <h3>COMPARACIÓN DE STATS</h3>
                        <div id="comparison-chart"></div>
                    </div>
                </div>
            </section>

        </div>
    </main>
    <script src="app.js">
        (() => {
    const App = (() => {

        /* =====================================================
           1. REFERENCIAS AL DOM
        ===================================================== */
        const htmlElements = {
            // Navegación
            navBuscar: document.getElementById('btn-nav-buscar'),
            navHistorico: document.getElementById('btn-nav-historico'),
            navVs: document.getElementById('btn-nav-vs'),
            navFavoritos: document.getElementById('btn-nav-favoritos'),

            views: document.querySelectorAll('.view-section'),

            // Buscar
            searchInput: document.getElementById('search-input'),
            searchBtn: document.getElementById('btn-search-action'),
            searchType: document.getElementsByName('searchType'),

            startMsg: document.getElementById('start-message'),
            pokemonCard: document.getElementById('pokemon-card-container'),
            abilityCard: document.getElementById('ability-card-container'),

            pokeName: document.getElementById('poke-name'),
            pokeSprite: document.getElementById('poke-sprite'),
            pokeTypes: document.getElementById('poke-types'),
            pokeAbilities: document.getElementById('poke-abilities'),
            pokeStats: document.getElementById('poke-stats-container'),
            favBtn: document.getElementById('btn-toggle-fav'),

            // Histórico
            historyList: document.getElementById('history-list'),
            clearHistory: document.getElementById('btn-clear-history'),

            // Favoritos
            favList: document.getElementById('favorites-list'),
            clearFavs: document.getElementById('btn-clear-favorites'),

            // VS
            vsInput1: document.getElementById('vs-input-1'),
            vsInput2: document.getElementById('vs-input-2'),
            vsBtn: document.getElementById('btn-start-battle'),

            battleResults: document.getElementById('battle-results'),
            f1Img: document.getElementById('f1-img'),
            f1Name: document.getElementById('f1-name'),
            f1Points: document.getElementById('f1-points'),

            f2Img: document.getElementById('f2-img'),
            f2Name: document.getElementById('f2-name'),
            f2Points: document.getElementById('f2-points')
        };

        /* =====================================================
           2. UTILIDADES
        ===================================================== */
        const utils = {
            async fetchPokemon(query) {
                const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${query.toLowerCase()}`);
                if (!res.ok) throw new Error('Pokémon no encontrado');
                return res.json();
            },

            getStorage(key) {
                return JSON.parse(localStorage.getItem(key)) || [];
            },

            setStorage(key, data) {
                localStorage.setItem(key, JSON.stringify(data));
            },

            showView(viewId) {
                el.views.forEach(v => v.classList.add('hidden'));
                document.getElementById(viewId).classList.remove('hidden');
            },

            getSearchType() {
                return [...el.searchType].find(r => r.checked).value;
            },

            totalStats(pokemon) {
                return pokemon.stats.reduce((acc, s) => acc + s.base_stat, 0);
            }
        };

        /* =====================================================
           3. TEMPLATES
        ===================================================== */
        const templates = {
            pokemon(pokemon) {
                el.startMsg.classList.add('hidden');
                el.pokemonCard.classList.remove('hidden');
                el.abilityCard.classList.add('hidden');

                el.pokeName.textContent = `#${pokemon.id} ${pokemon.name.toUpperCase()}`;
                el.pokeSprite.src = pokemon.sprites.front_default;

                el.pokeTypes.innerHTML = '';
                pokemon.types.forEach(t => {
                    el.pokeTypes.innerHTML += `<span>${t.type.name}</span>`;
                });

                el.pokeAbilities.innerHTML = '';
                pokemon.abilities.forEach(a => {
                    el.pokeAbilities.innerHTML += `<div>${a.ability.name}</div>`;
                });

                el.pokeStats.innerHTML = '';
                pokemon.stats.forEach(s => {
                    el.pokeStats.innerHTML += `
                        <div>${s.stat.name.toUpperCase()}: ${s.base_stat}</div>
                    `;
                });

                handlers.saveHistory(pokemon.name);
                handlers.syncFavButton(pokemon.name);
            },

            history() {
                const history = utils.getStorage('history');
                el.historyList.innerHTML = '';

                if (!history.length) {
                    el.historyList.innerHTML = `<p>No hay histórico</p>`;
                    return;
                }

                history.forEach(p => {
                    el.historyList.innerHTML += `<div>${p}</div>`;
                });
            },

            favorites() {
                const favs = utils.getStorage('favorites');
                el.favList.innerHTML = '';

                if (!favs.length) {
                    el.favList.innerHTML = `<p>No hay favoritos</p>`;
                    return;
                }

                favs.forEach(p => {
                    el.favList.innerHTML += `<div>${p}</div>`;
                });
            },

            battle(p1, p2) {
                el.battleResults.classList.remove('hidden');

                el.f1Img.src = p1.sprites.front_default;
                el.f1Name.textContent = p1.name.toUpperCase();
                el.f1Points.textContent = `${utils.totalStats(p1)} pts`;

                el.f2Img.src = p2.sprites.front_default;
                el.f2Name.textContent = p2.name.toUpperCase();
                el.f2Points.textContent = `${utils.totalStats(p2)} pts`;
            }
        };

        /* =====================================================
           4. HANDLERS
        ===================================================== */
        const handlers = {
            async search() {
                const query = el.searchInput.value.trim();
                if (!query) return alert('Ingresa un Pokémon');

                try {
                    const pokemon = await utils.fetchPokemon(query);
                    render.pokemon(pokemon);
                } catch (e) {
                    alert(e.message);
                }
            },

            saveHistory(name) {
                const history = utils.getStorage('history');
                if (!history.includes(name)) {
                    history.push(name);
                    utils.setStorage('history', history);
                }
            },

            toggleFavorite() {
                const name = el.pokeName.textContent.split(' ')[1].toLowerCase();
                let favs = utils.getStorage('favorites');

                favs = favs.includes(name)
                    ? favs.filter(f => f !== name)
                    : [...favs, name];

                utils.setStorage('favorites', favs);
                handlers.syncFavButton(name);
            },

            syncFavButton(name) {
                const favs = utils.getStorage('favorites');
                el.favBtn.innerHTML = favs.includes(name.toLowerCase())
                    ? `<i class="fa-solid fa-heart"></i>`
                    : `<i class="fa-regular fa-heart"></i>`;
            },

            async battle() {
                const p1 = el.vsInput1.value.trim();
                const p2 = el.vsInput2.value.trim();
                if (!p1 || !p2) return alert('Ingresa ambos Pokémon');

                try {
                    const pokemon1 = await utils.fetchPokemon(p1);
                    const pokemon2 = await utils.fetchPokemon(p2);
                    render.battle(pokemon1, pokemon2);
                } catch (e) {
                    alert(e.message);
                }
            }
        };

        /* =====================================================
           5. INIT
        ===================================================== */
        const init = () => {
            el.searchBtn.addEventListener('click', handlers.search);
            el.favBtn.addEventListener('click', handlers.toggleFavorite);

            el.clearHistory.addEventListener('click', () => {
                localStorage.removeItem('history');
                render.history();
            });

            el.clearFavs.addEventListener('click', () => {
                localStorage.removeItem('favorites');
                render.favorites();
            });

            el.vsBtn.addEventListener('click', handlers.battle);

            el.navBuscar.onclick = () => utils.showView('view-buscar');
            el.navHistorico.onclick = () => {
                utils.showView('view-historico');
                render.history();
            };
            el.navFavoritos.onclick = () => {
                utils.showView('view-favoritos');
                render.favorites();
            };
            el.navVs.onclick = () => utils.showView('view-vs');
        };

        return { init };
    })();

    App.init();
})();
    </script>
</body>
</html>